import{$ as Ve,B as H,C as l,D as E,E as C,G as ee,H as x,I as v,J as S,K as k,L as ce,M as te,N as ve,O as Se,P as Ce,Q as O,R as U,S as I,T as we,U as Ee,V as M,W as L,X as me,Y as ke,Z as Ie,_ as Me,a as he,aa as Pe,b as $,ba as V,c as se,ca as De,d as fe,da as Te,e as be,ea as Le,f as W,fa as A,g as z,ga as F,h as de,ha as Ae,i as w,ia as Fe,j as m,ja as N,k as p,ka as Ne,l as s,la as ie,m as _,ma as G,n as b,na as J,oa as K,p as c,pa as Re,q as _e,qa as We,r as Y,ra as Oe,s as n,sa as P,t as o,ta as D,u as g,ua as j,v as ye,w as xe,x as y,y as u,z as d}from"./chunk-B5YIJ3GE.js";function Ze(r,h){if(r&1){let e=y();n(0,"button",12),u("click",function(){m(e);let t=d(2);return p(t.resolve(!1))}),l(1),o()}if(r&2){let e=d(2);s(),C(" ",e.options.cancelText||"Cancel"," ")}}function qe(r,h){if(r&1){let e=y();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h5",5),g(5,"i",6),l(6),o()(),n(7,"div",7)(8,"p",8),l(9),o()(),n(10,"div",9),b(11,Ze,2,1,"button",10),n(12,"button",11),u("click",function(){m(e);let t=d();return p(t.resolve(!0))}),l(13),o()()()()()}if(r&2){let e=d();s(5),c("ngClass",e.options.type==="ALERT"?"bi-info-circle-fill":"bi-question-circle-fill"),s(),C(" ",e.options.title," "),s(3),E(e.options.message),s(2),c("ngIf",e.options.type==="CONFIRM"),s(2),C(" ",e.options.confirmText||"OK"," ")}}var Ue=(()=>{class r{constructor(e){this.dialogService=e,this.visible=!1,this.options={title:"",message:"",type:"ALERT"}}ngOnInit(){this.dialogService.dialogState$.subscribe(e=>{this.options=e,this.visible=!0})}resolve(e){this.visible=!1,this.dialogService.resolve(e)}static{this.\u0275fac=function(i){return new(i||r)(_(D))}}static{this.\u0275cmp=w({type:r,selectors:[["app-confirm-dialog"]],standalone:!0,features:[k],decls:1,vars:1,consts:[["class","modal d-block","tabindex","-1","style","background: rgba(0,0,0,0.5); z-index: 2000;",4,"ngIf"],["tabindex","-1",1,"modal","d-block",2,"background","rgba(0,0,0,0.5)","z-index","2000"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content","shadow-lg","border-0"],[1,"modal-header","text-white",2,"background-color","#2c3e50"],[1,"modal-title","fw-bold"],[1,"bi",3,"ngClass"],[1,"modal-body","p-4"],[1,"mb-0","fs-5","text-secondary"],[1,"modal-footer","bg-light"],["type","button","class","btn btn-outline-secondary px-4 fw-medium",3,"click",4,"ngIf"],["type","button",1,"btn","btn-primary","px-4","fw-bold",2,"background-color","#2c3e50","border-color","#2c3e50",3,"click"],["type","button",1,"btn","btn-outline-secondary","px-4","fw-medium",3,"click"]],template:function(i,t){i&1&&b(0,qe,14,5,"div",0),i&2&&c("ngIf",t.visible)},dependencies:[M,O,I],encapsulation:2})}}return r})();var B=(()=>{class r{constructor(e,i){this.http=e,this.dialogService=i,this.apiUrl="http://localhost:8080/api/auth",this.userRoleSubject=new $(sessionStorage.getItem("user_role")),this.userRole$=this.userRoleSubject.asObservable(),this.isLoggingOut=!1}login(e,i){return this.http.post(`${this.apiUrl}/login`,{username:e,password:i}).pipe(be(t=>{if(t.token){let a=t.token,f=a.split(":"),T=f.length>1?f[1]:"";sessionStorage.setItem("auth_token",a),sessionStorage.setItem("server_session_id",T),this.setRole(t.role),sessionStorage.setItem("user_role",t.role),sessionStorage.setItem("original_role",t.role)}}))}checkServerSession(){this.http.get(`${this.apiUrl}/status`).subscribe({next:e=>{let i=sessionStorage.getItem("server_session_id");i&&e.sessionId!==i&&(console.warn("Backend restarted. Session invalid."),this.logout(),this.dialogService.alert("Server Restarted","Server was restarted. Please login again."),window.location.reload())},error:()=>{}})}getOriginalRole(){return sessionStorage.getItem("original_role")}switchRole(e){this.setRole(e),sessionStorage.setItem("user_role",e)}logout(){this.isLoggingOut=!0,sessionStorage.removeItem("auth_token"),sessionStorage.removeItem("user_role"),sessionStorage.removeItem("original_role"),sessionStorage.removeItem("server_session_id"),this.userRoleSubject.next(null)}getRole(){return this.userRoleSubject.value}setRole(e){this.userRoleSubject.next(e)}static{this.\u0275fac=function(i){return new(i||r)(z(L),z(D))}}static{this.\u0275prov=W({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var oe=(()=>{class r{constructor(){this.currentYear=new Date().getFullYear(),this.currentMonth=new Date().getMonth()+1,this.selectionSubject=new $({month:this.currentMonth,year:this.currentYear}),this.selection$=this.selectionSubject.asObservable()}setSelection(e,i){this.selectionSubject.next({month:e,year:i})}getSelection(){return this.selectionSubject.value}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275prov=W({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var $e=r=>({disabled:r}),et=r=>["/payroll/attendance-casual",r];function tt(r,h){if(r&1){let e=y();n(0,"div",23),u("click",function(){m(e);let t=d(2);return p(t.toggleSidebar())}),o()}}function it(r,h){if(r&1){let e=y();n(0,"li",24)(1,"a",25),u("click",function(){m(e);let t=d(2);return p(t.toggleSidebar())}),g(2,"i",26),l(3," Employees "),o()()}}function nt(r,h){if(r&1){let e=y();n(0,"li",24)(1,"a",32),u("click",function(){m(e);let t=d(3);return p(t.toggleSidebar())}),g(2,"i",33),l(3," Casual Attendance "),o()()}if(r&2){let e=d(3);s(),c("routerLink",ce(1,et,e.currentPeriodId))}}function ot(r,h){r&1&&(n(0,"span",34),l(1,"Locked"),o())}function rt(r,h){if(r&1){let e=y();ye(0),n(1,"li",24)(2,"a",27),u("click",function(){m(e);let t=d(2);return p(t.toggleSidebar())}),g(3,"i",28),l(4," Dashboard "),o()(),b(5,nt,4,3,"li",12),n(6,"li",24)(7,"a",29),u("click",function(){m(e);let t=d(2);return p(t.isReportsEnabled()?t.toggleSidebar():null)}),g(8,"i",30),l(9," Reports "),b(10,ot,2,0,"span",31),o()(),xe()}if(r&2){let e=d(2);s(5),c("ngIf",e.currentPeriodId),s(2),c("ngClass",ce(3,$e,!e.isReportsEnabled())),s(3),c("ngIf",!e.isReportsEnabled())}}function lt(r,h){if(r&1){let e=y();n(0,"div",35)(1,"button",36),u("click",function(){m(e);let t=d(2);return t.switchRole("USER"),p(t.toggleSidebar())}),g(2,"i",37),l(3," View as User "),o()()}}function at(r,h){if(r&1){let e=y();n(0,"div",2),b(1,tt,1,0,"div",3),n(2,"div",4)(3,"div",5)(4,"h4",6),l(5,"FCI Payroll"),o(),n(6,"button",7),u("click",function(){m(e);let t=d();return p(t.toggleSidebar())}),g(7,"i",8),o()(),n(8,"div",9)(9,"small",10),l(10),o()(),n(11,"ul",11),b(12,it,4,0,"li",12)(13,rt,11,5,"ng-container",13),o(),g(14,"hr",14),b(15,lt,4,0,"div",15),n(16,"button",16),u("click",function(){m(e);let t=d();return p(t.logout())}),l(17,"Logout"),o()(),n(18,"div",17)(19,"nav",18)(20,"button",19),u("click",function(){m(e);let t=d();return p(t.toggleSidebar())}),g(21,"i",20),o(),n(22,"span",21),l(23,"Dashboard"),o()(),n(24,"div",22),g(25,"router-outlet"),o()()()}if(r&2){let e=h.ngIf,i=d();s(),c("ngIf",i.isSidebarOpen),s(),Y("open",i.isSidebarOpen),s(8),C("User: ",e,""),s(2),c("ngIf",e==="ADMIN"),s(),c("ngIf",e==="USER"),s(2),c("ngIf",i.canSwitchToUser())}}function st(r,h){r&1&&g(0,"router-outlet")}var Be=(()=>{class r{constructor(e,i,t,a){this.authService=e,this.payrollService=i,this.router=t,this.monthService=a,this.isSidebarOpen=!1,this.currentPeriodId=null,this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.selectedMonth=new Date().getMonth()+1,this.selectedYear=new Date().getFullYear();let f=this.monthService.getSelection();this.selectedMonth=f.month,this.selectedYear=f.year}goHome(){this.toggleSidebar()}toggleSidebar(){this.isSidebarOpen=!this.isSidebarOpen}ngOnInit(){this.authService.userRole$.subscribe(e=>{e?this.startPolling():this.stopPolling()}),this.payrollService.currentPeriod$.subscribe(e=>{e?(this.currentPeriodStatus=e.status,this.currentPeriodId=e.id):this.currentPeriodId=null})}startPolling(){this.pollInterval||(this.authService.getRole()&&this.authService.checkServerSession(),this.pollInterval=setInterval(()=>{this.authService.getRole()&&this.authService.checkServerSession()},3e3))}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}ngOnDestroy(){this.stopPolling()}isReportsEnabled(){return this.authService.getRole()==="ADMIN"?!0:this.currentPeriodStatus==="CLOSED"}logout(){this.authService.logout(),window.location.reload()}canSwitchToUser(){return this.authService.getRole()==="ADMIN"}switchRole(e){this.authService.switchRole(e),e==="ADMIN"?window.location.href="/admin/employees":window.location.href="/user/home"}updateGlobalSelection(){this.monthService.setSelection(this.selectedMonth,this.selectedYear)}static{this.\u0275fac=function(i){return new(i||r)(_(B),_(j),_(V),_(oe))}}static{this.\u0275cmp=w({type:r,selectors:[["app-root"]],standalone:!0,features:[k],decls:5,vars:4,consts:[["loginView",""],["class","d-flex h-100",4,"ngIf","ngIfElse"],[1,"d-flex","h-100"],["class","sidebar-overlay",3,"click",4,"ngIf"],[1,"sidebar","text-white","p-3","vh-100","shadow"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[1,"btn","btn-sm","btn-outline-light","border-0",3,"click"],[1,"bi","bi-x-lg"],[1,"mb-3"],[1,"text-white-50"],[1,"nav","flex-column","gap-2"],["class","nav-item",4,"ngIf"],[4,"ngIf"],[1,"mt-auto","border-secondary"],["class","mb-2",4,"ngIf"],[1,"btn","btn-danger","w-100",3,"click"],[1,"flex-grow-1","h-100","overflow-auto"],[1,"navbar","navbar-expand-lg","navbar-light","bg-white","shadow-sm","mb-4","px-4","sticky-top"],["title","Menu",1,"btn","btn-link","text-dark","me-3","p-0",3,"click"],[1,"bi","bi-list","fs-3"],[1,"navbar-brand","h1","mb-0"],[1,"px-4","pb-5"],[1,"sidebar-overlay",3,"click"],[1,"nav-item"],["routerLink","/admin/employees",1,"nav-link","text-white","btn","text-start","border-0",3,"click"],[1,"bi","bi-people","me-2"],["routerLink","/user/home",1,"nav-link","text-white","btn","text-start","border-0",3,"click"],[1,"bi","bi-house-door","me-2"],["routerLink","/reports",1,"nav-link","text-white","btn","text-start","border-0","mt-2",3,"click","ngClass"],[1,"bi","bi-file-earmark-text","me-2"],["class","badge ms-2 bg-secondary",4,"ngIf"],[1,"nav-link","text-white","btn","text-start","border-0","mt-2",3,"click","routerLink"],[1,"bi","bi-calendar-check","me-2"],[1,"badge","ms-2","bg-secondary"],[1,"mb-2"],[1,"btn","w-100","text-white","shadow-sm",2,"background-color","#2c5f2d","font-size","0.9rem",3,"click"],[1,"bi","bi-person-badge"]],template:function(i,t){if(i&1&&(g(0,"app-confirm-dialog"),b(1,at,26,7,"div",1),te(2,"async"),b(3,st,1,0,"ng-template",null,0,Ce)),i&2){let a=H(4);s(),c("ngIf",ve(2,2,t.authService.userRole$))("ngIfElse",a)}},dependencies:[M,O,I,we,Pe,De,P,Ue],styles:[`.sidebar[_ngcontent-%COMP%] {
          width: 250px;
          position: fixed;
          top: 0;
          left: -260px; 

          background-color: #0f2615;
          transition: left 0.3s ease-in-out;
          z-index: 1050;
      }
      .sidebar.open[_ngcontent-%COMP%] {
          left: 0;
      }
      .sidebar-overlay[_ngcontent-%COMP%] {
          position: fixed;
          top: 0; left: 0; right: 0; bottom: 0;
          background: rgba(0,0,0,0.5);
          z-index: 1040;
      }`]})}}return r})();var Ye=(()=>{class r{intercept(e,i){let t=sessionStorage.getItem("auth_token");return t&&(e=e.clone({setHeaders:{Authorization:t}})),i.handle(e)}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275prov=W({token:r,factory:r.\u0275fac})}}return r})();var ze=(()=>{class r{constructor(e,i){this.authService=e,this.dialogService=i}intercept(e,i){return i.handle(e).pipe(fe(t=>{if(t.status===0||t.status===401){if(this.authService.isLoggingOut)return se(()=>t);console.error("Session Invalid or Server Down. Logging out..."),this.authService.logout(),t.status===0?this.dialogService.alert("Connection Error","Connection lost. Please check if the server is running."):this.dialogService.alert("Session Expired","Session expired. Please login again."),window.location.href="/login"}return se(()=>t)}))}static{this.\u0275fac=function(i){return new(i||r)(z(B),z(D))}}static{this.\u0275prov=W({token:r,factory:r.\u0275fac})}}return r})();function dt(r,h){if(r&1&&(n(0,"p",19),g(1,"i",20),l(2),o()),r&2){let e=d();s(2),C(" ",e.errorMessage," ")}}var He=(()=>{class r{constructor(e,i){this.authService=e,this.router=i,this.username="",this.password="",this.errorMessage=""}ngOnInit(){let e=this.authService.getRole();e==="ADMIN"?this.router.navigate(["/admin/employees"],{replaceUrl:!0}):e==="USER"&&this.router.navigate(["/user/home"],{replaceUrl:!0})}onLogin(){this.authService.login(this.username,this.password).subscribe({next:e=>{e.role==="ADMIN"?this.router.navigate(["/admin/employees"]):this.router.navigate(["/payroll/entry/latest"])},error:e=>{console.error("Login error:",e),this.errorMessage=`Login Failed: ${e.status} - ${e.statusText||"Unknown Error"}`,e.status===0?this.errorMessage="Connection Failed. Is Backend running? (CORS/Network)":(e.status===401||e.status===500)&&(this.errorMessage="Invalid Credentials")}})}static{this.\u0275fac=function(i){return new(i||r)(_(B),_(V))}}static{this.\u0275cmp=w({type:r,selectors:[["app-login"]],standalone:!0,features:[k],decls:29,vars:3,consts:[[1,"d-flex","justify-content-center","align-items-center","vh-100",2,"background-color","#f2f0eb"],[1,"col-md-4"],[1,"card","shadow-lg","border-0","rounded-4",2,"background-color","#ffffff"],[1,"card-header","text-center","py-4","rounded-top-4",2,"background-color","#0f2615","color","#e8e6e1","border-bottom","4px solid #1e4d2b"],[1,"mb-0","fw-bold",2,"letter-spacing","1px"],[1,"text-uppercase",2,"letter-spacing","2px","font-size","0.7rem","color","#a3b18a"],[1,"card-body","p-5"],[1,"mb-4"],[1,"form-label","fw-bold","text-dark",2,"font-size","0.9rem","letter-spacing","0.5px"],[1,"input-group"],[1,"input-group-text","border-end-0","text-white",2,"background-color","#2c5f2d"],[1,"bi","bi-person"],["type","text","placeholder","Enter username",1,"form-control","border-start-0","bg-light",3,"ngModelChange","ngModel"],[1,"bi","bi-lock"],["type","password","placeholder","Enter password",1,"form-control","border-start-0","bg-light",3,"ngModelChange","ngModel"],["onmouseover","this.style.backgroundColor='#14361f'","onmouseout","this.style.backgroundColor='#1e4d2b'",1,"btn","w-100","py-2","fw-bold","text-uppercase","shadow-sm","text-white",2,"background-color","#1e4d2b","letter-spacing","2px","transition","0.3s",3,"click"],["class","text-danger mt-3 text-center small fw-bold",4,"ngIf"],[1,"card-footer","text-center","py-3","border-0","rounded-bottom-4",2,"background-color","#f2f0eb"],[2,"color","#555"],[1,"text-danger","mt-3","text-center","small","fw-bold"],[1,"bi","bi-exclamation-circle","me-1"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),l(5,"FCI Automation"),o(),n(6,"small",5),l(7,"Premium Secure Access"),o()(),n(8,"div",6)(9,"div",7)(10,"label",8),l(11,"USERNAME"),o(),n(12,"div",9)(13,"span",10),g(14,"i",11),o(),n(15,"input",12),S("ngModelChange",function(f){return v(t.username,f)||(t.username=f),f}),o()()(),n(16,"div",7)(17,"label",8),l(18,"PASSWORD"),o(),n(19,"div",9)(20,"span",10),g(21,"i",13),o(),n(22,"input",14),S("ngModelChange",function(f){return v(t.password,f)||(t.password=f),f}),o()()(),n(23,"button",15),u("click",function(){return t.onLogin()}),l(24," Login "),o(),b(25,dt,3,1,"p",16),o(),n(26,"div",17)(27,"small",18),l(28,"FCI Payroll System \xA9 2025"),o()()()()()),i&2&&(s(15),x("ngModel",t.username),s(7),x("ngModel",t.password),s(3),c("ngIf",t.errorMessage))},dependencies:[M,I,P,A,F,N],encapsulation:2})}}return r})();function ct(r,h){if(r&1){let e=y();n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td")(6,"span",17),l(7),o()(),n(8,"td"),l(9),o(),n(10,"td"),l(11),o(),n(12,"td"),l(13),o(),n(14,"td")(15,"span",18),l(16),o()(),n(17,"td")(18,"button",19),u("click",function(){let t=m(e).$implicit,a=d();return p(a.openEditModal(t))}),l(19,"Edit"),o(),n(20,"button",20),u("click",function(){let t=m(e).$implicit,a=d();return p(a.deleteEmployee(t.id))}),l(21,"Delete"),o()()()}if(r&2){let e=h.$implicit;s(2),E(e.memberId),s(2),E(e.fullName),s(2),_e("background-color",e.category==="HL"?"#2c3e50":"#7f8c8d"),s(),E(e.category),s(2),E(e.uanNumber),s(2),E(e.ipNumber),s(2),E(e.bankAccountNo),s(2),c("ngClass",e.status==="ACTIVE"?"bg-success":"bg-secondary"),s(),C(" ",e.status," ")}}function mt(r,h){if(r&1){let e=y();n(0,"div",21)(1,"div",22)(2,"div",23)(3,"div",24)(4,"h5",25),l(5),o(),n(6,"button",26),u("click",function(){m(e);let t=d();return p(t.showModal=!1)}),o()(),n(7,"div",27)(8,"form")(9,"div",28)(10,"label"),l(11,"Member ID"),o(),n(12,"input",29),S("ngModelChange",function(t){m(e);let a=d();return v(a.currentEmployee.memberId,t)||(a.currentEmployee.memberId=t),p(t)}),o()(),n(13,"div",28)(14,"label"),l(15,"Full Name"),o(),n(16,"input",30),S("ngModelChange",function(t){m(e);let a=d();return v(a.currentEmployee.fullName,t)||(a.currentEmployee.fullName=t),p(t)}),o()(),n(17,"div",31)(18,"div",32)(19,"label"),l(20,"UAN"),o(),n(21,"input",33),S("ngModelChange",function(t){m(e);let a=d();return v(a.currentEmployee.uanNumber,t)||(a.currentEmployee.uanNumber=t),p(t)}),u("keypress",function(t){m(e);let a=d();return p(a.onlyNumbers(t))}),o()(),n(22,"div",32)(23,"label"),l(24,"IP Number"),o(),n(25,"input",34),S("ngModelChange",function(t){m(e);let a=d();return v(a.currentEmployee.ipNumber,t)||(a.currentEmployee.ipNumber=t),p(t)}),u("keypress",function(t){m(e);let a=d();return p(a.onlyNumbers(t))}),o()()(),n(26,"div",31)(27,"div",32)(28,"label"),l(29,"Bank A/c"),o(),n(30,"input",35),S("ngModelChange",function(t){m(e);let a=d();return v(a.currentEmployee.bankAccountNo,t)||(a.currentEmployee.bankAccountNo=t),p(t)}),u("keypress",function(t){m(e);let a=d();return p(a.onlyNumbers(t))}),o()(),n(31,"div",32)(32,"label"),l(33,"IFSC"),o(),n(34,"input",36),S("ngModelChange",function(t){m(e);let a=d();return v(a.currentEmployee.ifscCode,t)||(a.currentEmployee.ifscCode=t),p(t)}),o()()(),n(35,"div",28)(36,"label"),l(37,"Status"),o(),n(38,"select",37),S("ngModelChange",function(t){m(e);let a=d();return v(a.currentEmployee.status,t)||(a.currentEmployee.status=t),p(t)}),n(39,"option",38),l(40,"ACTIVE"),o(),n(41,"option",39),l(42,"INACTIVE"),o()()(),n(43,"div",28)(44,"label"),l(45,"Inactive Date (Last Working Day)"),o(),n(46,"input",40),S("ngModelChange",function(t){m(e);let a=d();return v(a.currentEmployee.inactiveDate,t)||(a.currentEmployee.inactiveDate=t),p(t)}),o(),n(47,"small",41),l(48,"If set, employee will be excluded from payroll periods starting AFTER this date."),o()(),n(49,"div",28)(50,"label"),l(51,"Category"),o(),n(52,"select",42),S("ngModelChange",function(t){m(e);let a=d();return v(a.currentEmployee.category,t)||(a.currentEmployee.category=t),p(t)}),n(53,"option",43),l(54,"Casual Labour (CL)"),o(),n(55,"option",44),l(56,"Head Loader (HL)"),o()()()()(),n(57,"div",45)(58,"button",46),u("click",function(){m(e);let t=d();return p(t.showModal=!1)}),l(59,"Close"),o(),n(60,"button",47),u("click",function(){m(e);let t=d();return p(t.saveEmployee())}),l(61,"Save Changes"),o()()()()()}if(r&2){let e=d();s(5),C("",e.isEditMode?"Edit":"Add"," Employee"),s(7),x("ngModel",e.currentEmployee.memberId),s(4),x("ngModel",e.currentEmployee.fullName),s(5),x("ngModel",e.currentEmployee.uanNumber),s(4),x("ngModel",e.currentEmployee.ipNumber),s(5),x("ngModel",e.currentEmployee.bankAccountNo),s(4),x("ngModel",e.currentEmployee.ifscCode),s(4),x("ngModel",e.currentEmployee.status),s(8),x("ngModel",e.currentEmployee.inactiveDate),s(6),x("ngModel",e.currentEmployee.category)}}var Ge=(()=>{class r{constructor(e,i){this.http=e,this.dialogService=i,this.employees=[],this.showModal=!1,this.isEditMode=!1,this.currentEmployee=this.getEmptyEmployee()}ngOnInit(){this.loadEmployees()}loadEmployees(){this.http.get("http://localhost:8080/api/employees").subscribe({next:e=>this.employees=e,error:e=>console.error("Failed to load employees",e)})}getEmptyEmployee(){return{memberId:"",fullName:"",uanNumber:"",ipNumber:"",bankAccountNo:"",ifscCode:"",status:"ACTIVE",category:"CL"}}openAddModal(){this.isEditMode=!1,this.currentEmployee=this.getEmptyEmployee(),this.showModal=!0}openEditModal(e){this.isEditMode=!0,this.currentEmployee=he({},e),this.showModal=!0}saveEmployee(){this.isEditMode?this.http.put(`http://localhost:8080/api/employees/${this.currentEmployee.id}`,this.currentEmployee).subscribe({next:()=>{this.loadEmployees(),this.showModal=!1,this.dialogService.alert("Success","Employee updated successfully!")},error:e=>{console.error(e),this.dialogService.alert("Error","Failed to update: "+(e.error?.message||e.message))}}):this.http.post("http://localhost:8080/api/employees",this.currentEmployee).subscribe({next:()=>{this.loadEmployees(),this.showModal=!1,this.dialogService.alert("Success","Employee added successfully!")},error:e=>{console.error(e),this.dialogService.alert("Error","Failed to add: "+(e.error?.message||e.message))}})}deleteEmployee(e){this.dialogService.confirm("Delete Employee","Are you sure you want to delete this employee? This action cannot be undone.").subscribe(i=>{i&&this.http.delete(`http://localhost:8080/api/employees/${e}`).subscribe({next:()=>{this.loadEmployees(),this.dialogService.alert("Success","Employee deleted successfully.")},error:t=>{console.error(t),this.dialogService.alert("Error","Failed to delete: "+(t.error?.message||t.message))}})})}onFileSelected(e){let i=e.target.files[0];if(i){let t=new FormData;t.append("file",i),this.http.post("http://localhost:8080/api/employees/upload",t).subscribe({next:a=>{this.employees=[...this.employees,...a],this.dialogService.alert("Success",`Successfully imported ${a.length} employees!`),e.target.value=""},error:a=>{console.error(a),this.dialogService.alert("Error","Upload failed: "+(a.error?.message||a.message)),e.target.value=""}})}}onlyNumbers(e){let i=/[0-9]/,t=String.fromCharCode(e.charCode);i.test(t)||e.preventDefault()}static{this.\u0275fac=function(i){return new(i||r)(_(L),_(D))}}static{this.\u0275cmp=w({type:r,selectors:[["app-employee-list"]],standalone:!0,features:[k],decls:36,vars:2,consts:[["fileInput",""],[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"d-flex","gap-2"],["type","file","accept",".xlsx, .xls",2,"display","none",3,"change"],[1,"btn","border-0","shadow-sm","text-white",2,"background-color","#2c5f2d","font-weight","500",3,"click"],[1,"bi","bi-upload"],[1,"btn","border-0","shadow-sm","text-white",2,"background-color","#0f2615",3,"click"],[1,"card","shadow"],[1,"card-body","p-0"],[1,"table","table-striped","mb-0"],[1,"text-white",2,"background-color","#0f2615"],[1,"py-3","ps-3","rounded-top-left",2,"border-bottom","3px solid #1e4d2b"],[1,"py-3",2,"border-bottom","3px solid #1e4d2b"],[1,"py-3","rounded-top-right",2,"border-bottom","3px solid #1e4d2b"],[4,"ngFor","ngForOf"],["class","modal d-block","style","background: rgba(0,0,0,0.5)",4,"ngIf"],[1,"badge","text-white"],[1,"badge",3,"ngClass"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"modal","d-block",2,"background","rgba(0,0,0,0.5)"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-2"],["type","text","name","memberId",1,"form-control",3,"ngModelChange","ngModel"],["type","text","name","fullName",1,"form-control",3,"ngModelChange","ngModel"],[1,"row"],[1,"col","mb-2"],["type","text","name","uan","maxlength","12","placeholder","Numbers only",1,"form-control",3,"ngModelChange","keypress","ngModel"],["type","text","name","ip","placeholder","Numbers only",1,"form-control",3,"ngModelChange","keypress","ngModel"],["type","text","name","bank","placeholder","Numbers only",1,"form-control",3,"ngModelChange","keypress","ngModel"],["type","text","name","ifsc",1,"form-control",3,"ngModelChange","ngModel"],["name","status",1,"form-select",3,"ngModelChange","ngModel"],["value","ACTIVE"],["value","INACTIVE"],["type","date","name","inactiveDate",1,"form-control",3,"ngModelChange","ngModel"],[1,"text-muted"],["name","category",1,"form-select",3,"ngModelChange","ngModel"],["value","CL"],["value","HL"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"]],template:function(i,t){if(i&1){let a=y();n(0,"div",1)(1,"div",2)(2,"h2"),l(3,"Employee Master (Admin)"),o(),n(4,"div",3)(5,"input",4,0),u("change",function(T){return m(a),p(t.onFileSelected(T))}),o(),n(7,"button",5),u("click",function(){m(a);let T=H(6);return p(T.click())}),g(8,"i",6),l(9," Import Excel "),o(),n(10,"button",7),u("click",function(){return m(a),p(t.openAddModal())}),l(11,"+ Add New"),o()()(),n(12,"div",8)(13,"div",9)(14,"table",10)(15,"thead",11)(16,"tr")(17,"th",12),l(18,"Member ID"),o(),n(19,"th",13),l(20,"Name"),o(),n(21,"th",13),l(22,"Category"),o(),n(23,"th",13),l(24,"UAN"),o(),n(25,"th",13),l(26,"IP Number"),o(),n(27,"th",13),l(28,"Bank A/c"),o(),n(29,"th",13),l(30,"Status"),o(),n(31,"th",14),l(32,"Actions"),o()()(),n(33,"tbody"),b(34,ct,22,10,"tr",15),o()()()(),b(35,mt,62,10,"div",16),o()}i&2&&(s(34),c("ngForOf",t.employees),s(),c("ngIf",t.showModal))},dependencies:[M,O,U,I,P,Ne,J,K,A,G,F,Ae,Oe,N,Fe],encapsulation:2})}}return r})();function pt(r,h){r&1&&(n(0,"span",28),l(1,"LOCKED"),o())}function ut(r,h){if(r&1&&(n(0,"p",29),l(1),o()),r&2){let e=d();s(),ee(" Period: ",e.period.month,"/",e.period.year," | Last Working Day: ",e.period.lastWorkingDay," ")}}function gt(r,h){if(r&1){let e=y();n(0,"div",30)(1,"button",31),u("click",function(){m(e);let t=d();return p(t.downloadTemplate())}),g(2,"i",32),l(3," Template "),o(),n(4,"button",31),u("click",function(){m(e),d();let t=H(10);return p(t.click())}),g(5,"i",33),l(6," Import Excel "),o()()}if(r&2){let e=d();s(),c("disabled",e.isCalcLoading),s(3),c("disabled",e.isCalcLoading)}}function ht(r,h){r&1&&g(0,"span",34)}function ft(r,h){r&1&&g(0,"i",35)}function bt(r,h){if(r&1){let e=y();n(0,"button",36),u("click",function(){m(e);let t=d();return p(t.finalize())}),g(1,"i",37),l(2," Finalize "),o()}if(r&2){let e=d();c("disabled",e.isCalcLoading)}}function _t(r,h){if(r&1){let e=y();n(0,"button",38),u("click",function(){m(e);let t=d();return p(t.unlock())}),g(1,"i",39),l(2," Unlock "),o()}if(r&2){let e=d();c("disabled",e.isCalcLoading)}}function yt(r,h){if(r&1){let e=y();n(0,"tr")(1,"td",40)(2,"div",41),l(3),o(),n(4,"div",42),l(5),o()(),n(6,"td",43)(7,"input",44),S("ngModelChange",function(t){let a=m(e).$implicit;return v(a.daysWorked,t)||(a.daysWorked=t),p(t)}),o()(),n(8,"td",43)(9,"input",45),S("ngModelChange",function(t){let a=m(e).$implicit;return v(a.wagesEarned,t)||(a.wagesEarned=t),p(t)}),o()(),n(10,"td",43)(11,"div",46)(12,"span",47),g(13,"i",48),o(),n(14,"input",49),S("ngModelChange",function(t){let a=m(e).$implicit;return v(a.advanceDeduction,t)||(a.advanceDeduction=t),p(t)}),o()()(),n(15,"td",50)(16,"span",51),l(17),te(18,"currency"),o()()()}if(r&2){let e=h.$implicit,i=d();Y("table-secondary",(i.period==null?null:i.period.status)==="CLOSED"),s(3),E(e.employee.fullName),s(2),E(e.employee.memberId),s(2),x("ngModel",e.daysWorked),c("disabled",(i.period==null?null:i.period.status)==="CLOSED"),s(2),x("ngModel",e.wagesEarned),c("disabled",(i.period==null?null:i.period.status)==="CLOSED"),s(5),x("ngModel",e.advanceDeduction),c("disabled",(i.period==null?null:i.period.status)==="CLOSED"),s(3),C(" ",Se(18,11,e.netPayable,"INR","symbol","1.0-0")," ")}}function xt(r,h){r&1&&(n(0,"tr")(1,"td",52)(2,"div",53),l(3,"Loading or No Employees Found..."),o()()())}var Je=(()=>{class r{constructor(e,i,t,a,f){this.http=e,this.route=i,this.router=t,this.payrollService=a,this.dialogService=f,this.periodId="latest",this.entries=[],this.period=null,this.isCalcLoading=!1}ngOnInit(){this.route.params.subscribe(e=>{e.periodId&&(this.periodId=e.periodId),this.loadData()})}loadData(){this.payrollService.loadPeriod(this.periodId),this.payrollService.currentPeriod$.subscribe(e=>this.period=e),this.http.get(`http://localhost:8080/api/payroll/periods/${this.periodId}/entries`).subscribe({next:e=>this.entries=e,error:e=>console.error("Error loading payroll",e)})}downloadTemplate(){this.payrollService.downloadTemplate().subscribe({next:e=>{let i=e.body;if(!i)return;let t=window.URL.createObjectURL(i),a=document.createElement("a");a.href=t,a.download="Payroll_Import_Template.xlsx",a.click()},error:e=>this.dialogService.alert("Error","Failed to download template")})}onFileSelected(e){let i=e.target.files[0];i&&this.period&&(this.isCalcLoading=!0,this.payrollService.importEntries(i,this.period.id).subscribe({next:t=>{this.dialogService.alert("Success",t.message),this.loadData(),this.isCalcLoading=!1},error:t=>{this.dialogService.alert("Error","Import Failed: "+(t.error?.message||t.message)),this.isCalcLoading=!1}})),e.target.value=""}saveAndCalculate(){return this.http.put("http://localhost:8080/api/payroll/entries",this.entries)}calculateAll(){this.isCalcLoading=!0,this.saveAndCalculate().subscribe({next:e=>{this.entries=e,this.sortEntries(),this.isCalcLoading=!1,this.dialogService.alert("Success","Saved & Calculated Successfully")},error:e=>{console.error(e),this.isCalcLoading=!1,this.dialogService.alert("Error","Failed to save: "+(e.error?.message||e.message))}})}finalize(){this.dialogService.confirm("Finalize Period","Are you sure you want to Finalize? This will SAVE current data and LOCK the period.").subscribe(e=>{e&&this.period&&(this.isCalcLoading=!0,this.saveAndCalculate().subscribe({next:i=>{this.entries=i,this.sortEntries(),this.payrollService.closePeriod(this.period.id).subscribe({next:()=>{this.isCalcLoading=!1,this.dialogService.alert("Success","Period Finalized Successfully!"),this.loadData()},error:t=>{this.isCalcLoading=!1,this.dialogService.alert("Error","Saved, but failed to finalize: "+t.message)}})},error:i=>{this.isCalcLoading=!1,this.dialogService.alert("Error","Cannot Finalize: Failed to save data. "+i.message)}}))})}unlock(){this.dialogService.confirm("Unlock Period","Are you sure you want to UNLOCK this period for editing?").subscribe(e=>{e&&this.period&&this.payrollService.reopenPeriod(this.period.id).subscribe({next:()=>{this.dialogService.alert("Success","Period Unlocked!"),this.loadData()},error:i=>this.dialogService.alert("Error","Failed to unlock: "+i.message)})})}sortEntries(){this.entries.sort((e,i)=>{let t=parseInt(e.employee.memberId),a=parseInt(i.employee.memberId);return!isNaN(t)&&!isNaN(a)?t-a:e.employee.memberId.localeCompare(i.employee.memberId)})}static{this.\u0275fac=function(i){return new(i||r)(_(L),_(Ve),_(V),_(j),_(D))}}static{this.\u0275cmp=w({type:r,selectors:[["app-payroll-entry"]],standalone:!0,features:[k],decls:39,vars:10,consts:[["fileInput",""],[1,"container-fluid","py-4","min-vh-100","bg-light"],[1,"d-flex","justify-content-between","align-items-center","mb-4","px-3"],[1,"fw-bold","mb-0","text-dark"],[1,"bi","bi-grid-3x3-gap","me-2","text-success"],["class","badge bg-danger ms-2",4,"ngIf"],["class","text-muted mb-0 small",4,"ngIf"],[1,"d-flex","gap-2"],["type","file","accept",".xlsx, .xls",1,"d-none",3,"change"],["class","btn-group",4,"ngIf"],[1,"btn","btn-primary","d-flex","align-items-center",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","bi bi-calculator me-2",4,"ngIf"],["class","btn btn-success d-flex align-items-center",3,"disabled","click",4,"ngIf"],["class","btn btn-warning d-flex align-items-center",3,"disabled","click",4,"ngIf"],[1,"card","border-0","shadow-sm","mx-3","overflow-hidden","rounded-3"],[1,"table-responsive"],[1,"table","table-hover","mb-0","align-middle"],[1,"bg-dark","text-white"],[1,"py-3","px-4"],[1,"py-3","text-center",2,"width","140px"],[1,"py-3","text-center",2,"width","180px"],[1,"py-3","text-center",2,"width","220px"],[1,"py-3","text-end","px-4",2,"width","150px"],[3,"table-secondary",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"text-center","mt-3","text-muted","small"],[1,"bi","bi-info-circle","me-1"],[1,"badge","bg-danger","ms-2"],[1,"text-muted","mb-0","small"],[1,"btn-group"],[1,"btn","btn-outline-primary",3,"click","disabled"],[1,"bi","bi-download"],[1,"bi","bi-upload"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-calculator","me-2"],[1,"btn","btn-success","d-flex","align-items-center",3,"click","disabled"],[1,"bi","bi-lock-fill","me-2"],[1,"btn","btn-warning","d-flex","align-items-center",3,"click","disabled"],[1,"bi","bi-unlock-fill","me-2"],[1,"px-4"],[1,"fw-bold","text-dark"],[1,"small","text-muted","font-monospace"],[1,"text-center"],["type","number","min","0","max","31","placeholder","0",1,"form-control","text-center","fw-semibold","border-0","bg-transparent",3,"ngModelChange","ngModel","disabled"],["type","number","min","0","placeholder","0",1,"form-control","text-center","fw-semibold","border-0","bg-transparent",3,"ngModelChange","ngModel","disabled"],[1,"input-group","input-group-sm"],[1,"input-group-text","bg-transparent","border-0"],[1,"bi","bi-dash-circle","text-muted"],["type","number","min","0","placeholder","0",1,"form-control","border-0","bg-transparent","shadow-none",3,"ngModelChange","ngModel","disabled"],[1,"text-end","px-4"],[1,"badge","bg-success-subtle","text-success","fs-6","rounded-pill","px-3"],["colspan","5",1,"text-center","py-5"],[1,"text-muted"]],template:function(i,t){if(i&1){let a=y();n(0,"div",1)(1,"div",2)(2,"div")(3,"h2",3),g(4,"i",4),l(5,"Monthly Payroll Entry "),b(6,pt,2,0,"span",5),o(),b(7,ut,2,3,"p",6),o(),n(8,"div",7)(9,"input",8,0),u("change",function(T){return m(a),p(t.onFileSelected(T))}),o(),b(11,gt,7,2,"div",9),n(12,"button",10),u("click",function(){return m(a),p(t.calculateAll())}),b(13,ht,1,0,"span",11)(14,ft,1,0,"i",12),l(15," Save & Calculate "),o(),b(16,bt,3,1,"button",13)(17,_t,3,1,"button",14),o()(),n(18,"div",15)(19,"div",16)(20,"table",17)(21,"thead",18)(22,"tr")(23,"th",19),l(24,"Employee"),o(),n(25,"th",20),l(26,"Days Worked"),o(),n(27,"th",21),l(28,"Wages Earned (\u20B9)"),o(),n(29,"th",22),l(30,"Advance (\u20B9)"),o(),n(31,"th",23),l(32,"Net Pay"),o()()(),n(33,"tbody"),b(34,yt,19,16,"tr",24)(35,xt,4,0,"tr",25),o()()()(),n(36,"div",26),g(37,"i",27),l(38," Values are auto-saved locally but must be 'Calculated' to update Net Pay. "),o()()}i&2&&(s(6),c("ngIf",(t.period==null?null:t.period.status)==="CLOSED"),s(),c("ngIf",t.period),s(4),c("ngIf",(t.period==null?null:t.period.status)!=="CLOSED"),s(),c("disabled",(t.period==null?null:t.period.status)==="CLOSED"||t.isCalcLoading),s(),c("ngIf",t.isCalcLoading),s(),c("ngIf",!t.isCalcLoading),s(2),c("ngIf",(t.period==null?null:t.period.status)!=="CLOSED"),s(),c("ngIf",(t.period==null?null:t.period.status)==="CLOSED"),s(17),c("ngForOf",t.entries),s(),c("ngIf",t.entries.length===0))},dependencies:[M,U,I,Ee,P,A,ie,F,We,Re,N],encapsulation:2})}}return r})();function vt(r,h){r&1&&(n(0,"div",32),g(1,"span",33),l(2," Loading periods... "),o())}function St(r,h){r&1&&(n(0,"div",34),l(1," No payroll periods found. Please create one in Dashboard first. "),o())}function Ct(r,h){if(r&1&&(n(0,"option",37),l(1),o()),r&2){let e=h.$implicit,i=d(2);c("value",e.id),s(),ee(" ",i.getMonthName(e.month)," ",e.year," (",e.status,") ")}}function wt(r,h){if(r&1){let e=y();n(0,"select",35),S("ngModelChange",function(t){m(e);let a=d();return v(a.selectedPeriodId,t)||(a.selectedPeriodId=t),p(t)}),b(1,Ct,2,4,"option",36),o()}if(r&2){let e=d();x("ngModel",e.selectedPeriodId),s(),c("ngForOf",e.periods)}}function Et(r,h){if(r&1&&(n(0,"small",38),l(1),o()),r&2){let e=d();Y("text-danger",e.utrUploadError)("text-success",!e.utrUploadError),s(),C(" ",e.utrUploadMsg," ")}}var Ke=(()=>{class r{constructor(e,i,t,a){this.http=e,this.router=i,this.payrollService=t,this.dialogService=a,this.selectedPeriodId=null,this.periods=[],this.loading=!0,this.bulkDate=new Date().toISOString().split("T")[0],this.utrFile=null,this.utrUploadMsg=null,this.utrUploadError=!1}ngOnInit(){this.payrollService.getPeriods().subscribe({next:e=>{this.periods=e;let i=this.payrollService.getGlobalSelection();if(i){let t=this.periods.find(a=>a.month===i.month&&a.year===i.year);t?this.selectedPeriodId=t.id:this.selectedPeriodId=this.periods.length>0?this.periods[0].id:null}else this.periods.length>0&&(this.selectedPeriodId=this.periods[0].id);this.loading=!1},error:e=>{console.error("Failed to load periods",e),this.loading=!1}})}getMonthName(e){let i=new Date;return i.setMonth(e-1),i.toLocaleString("default",{month:"long"})}download(e){let i=`http://localhost:8080/api/reports/${this.selectedPeriodId}/${e}`;e==="bulk"&&(i+=`?paymentDate=${this.bulkDate}`),this.http.get(i,{responseType:"blob",observe:"response"}).subscribe({next:t=>{let a=t.body;if(!a){this.dialogService.alert("Error","File not found or empty response.");return}let f=window.URL.createObjectURL(a),T=document.createElement("a");T.href=f;let q=`${e}_report.pdf`;e==="esi"&&(q="esi_return.xls"),e==="epf"&&(q="epf_return.txt");let ge=t.headers.get("Content-Disposition");if(ge){let ae=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(ge);ae!=null&&ae[1]&&(q=ae[1].replace(/['"]/g,""))}T.download=q,T.click(),window.URL.revokeObjectURL(f)},error:t=>{console.error(t),this.dialogService.alert("Error","Download failed! "+(t.statusText||"Server Error"))}})}onUtrFileSelected(e){e.target.files.length>0&&(this.utrFile=e.target.files[0],this.utrUploadMsg=null)}uploadUtr(){!this.utrFile||!this.selectedPeriodId||(this.utrUploadMsg="Uploading...",this.utrUploadError=!1,this.payrollService.importUtr(this.utrFile,this.selectedPeriodId).subscribe({next:e=>{this.utrUploadMsg=e.message||"Import Successful.",this.utrFile=null},error:e=>{console.error(e),this.utrUploadError=!0,this.utrUploadMsg=e.error?.message||"Import Failed."}}))}static{this.\u0275fac=function(i){return new(i||r)(_(L),_(V),_(j),_(D))}}static{this.\u0275cmp=w({type:r,selectors:[["app-reports"]],standalone:!0,features:[k],decls:55,vars:16,consts:[[1,"container","mt-4"],[1,"card","shadow"],[1,"card-header","bg-secondary","text-white"],[1,"mb-0"],[1,"card-body"],["class","text-center py-3",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","form-select mb-3",3,"ngModel","ngModelChange",4,"ngIf"],[1,"row","g-4"],[1,"col-md-6"],[1,"text-primary"],[1,"d-grid","gap-2"],[1,"btn","btn-outline-danger","text-start",3,"click","disabled"],[1,"bi","bi-file-pdf"],[1,"mt-4","border-top","pt-3"],[1,"text-muted","fw-bold"],[1,"bi","bi-bank"],[1,"input-group","input-group-sm","mt-2"],["type","file","accept",".xlsx, .xls",1,"form-control",3,"change","disabled"],[1,"btn","btn-outline-primary",3,"click","disabled"],[1,"bi","bi-upload"],["class","text-muted",3,"text-danger","text-success",4,"ngIf"],[1,"text-success"],[1,"btn","btn-outline-success","text-start",3,"click","disabled"],[1,"bi","bi-file-excel"],[1,"btn","btn-outline-dark","text-start",3,"click","disabled"],[1,"bi","bi-file-text"],[1,"mt-3","border-top","pt-2"],[1,"form-label","small","fw-bold","text-muted"],[1,"input-group"],["type","date",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"text-center","py-3"],[1,"spinner-border","spinner-border-sm","text-primary"],[1,"alert","alert-warning"],[1,"form-select","mb-3",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"text-muted"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),l(4,"Select Payroll Period"),o()(),n(5,"div",4),b(6,vt,3,0,"div",5)(7,St,2,0,"div",6)(8,wt,2,2,"select",7),g(9,"hr"),n(10,"div",8)(11,"div",9)(12,"h5",10),l(13,"PDF Reports"),o(),n(14,"div",11)(15,"button",12),u("click",function(){return t.download("main-file")}),g(16,"i",13),l(17," Main File (Payroll Engine) "),o(),n(18,"button",12),u("click",function(){return t.download("payment-details")}),g(19,"i",13),l(20," Payment Details (Bank) "),o(),n(21,"button",12),u("click",function(){return t.download("wage-summary")}),g(22,"i",13),l(23," Wage Summary "),o(),n(24,"button",12),u("click",function(){return t.download("attendance")}),g(25,"i",13),l(26," Attendance Register "),o()(),n(27,"div",14)(28,"h6",15),g(29,"i",16),l(30," Upload Bank Statement (UTR)"),o(),n(31,"div",17)(32,"input",18),u("change",function(f){return t.onUtrFileSelected(f)}),o(),n(33,"button",19),u("click",function(){return t.uploadUtr()}),g(34,"i",20),l(35," Import "),o()(),b(36,Et,2,5,"small",21),o()(),n(37,"div",9)(38,"h5",22),l(39,"Compliance Returns"),o(),n(40,"div",11)(41,"button",23),u("click",function(){return t.download("esi")}),g(42,"i",24),l(43," ESI Return (.xls) "),o(),n(44,"button",25),u("click",function(){return t.download("epf")}),g(45,"i",26),l(46," EPF Return (.txt) "),o(),n(47,"div",27)(48,"label",28),l(49,"Bulk Payment Date"),o(),n(50,"div",29)(51,"input",30),S("ngModelChange",function(f){return v(t.bulkDate,f)||(t.bulkDate=f),f}),o(),n(52,"button",31),u("click",function(){return t.download("bulk")}),g(53,"i",26),l(54," Download (.txt) "),o()()()()()()()()()),i&2&&(s(6),c("ngIf",t.loading),s(),c("ngIf",!t.loading&&t.periods.length===0),s(),c("ngIf",!t.loading&&t.periods.length>0),s(2),Y("opacity-50",!t.selectedPeriodId),s(5),c("disabled",!t.selectedPeriodId),s(3),c("disabled",!t.selectedPeriodId),s(3),c("disabled",!t.selectedPeriodId),s(3),c("disabled",!t.selectedPeriodId),s(8),c("disabled",!t.selectedPeriodId),s(),c("disabled",!t.selectedPeriodId||!t.utrFile),s(3),c("ngIf",t.utrUploadMsg),s(5),c("disabled",!t.selectedPeriodId),s(3),c("disabled",!t.selectedPeriodId),s(7),x("ngModel",t.bulkDate),s(),c("disabled",!t.selectedPeriodId))},dependencies:[M,U,I,P,J,K,A,G,F,N],encapsulation:2})}}return r})();function kt(r,h){if(r&1){let e=y();n(0,"div",8)(1,"div",9)(2,"div",10),u("click",function(){m(e);let t=d();return p(t.toggleEntryForm("payroll"))}),n(3,"div",11)(4,"div",12),g(5,"i",13),o(),n(6,"h4",14),l(7,"File New Report"),o(),n(8,"p",15),l(9,"Start new monthly payroll entry."),o(),n(10,"button",16),l(11,"Get Started"),o()()()(),n(12,"div",9)(13,"div",10),u("click",function(){m(e);let t=d();return p(t.toggleEntryForm("casual"))}),n(14,"div",11)(15,"div",17),g(16,"i",18),o(),n(17,"h4",14),l(18,"Casual Attendance"),o(),n(19,"p",15),l(20,"Mark daily attendance for casual labourers."),o(),n(21,"button",19),l(22,"Mark Attendance"),o()()()(),n(23,"div",9)(24,"div",10),u("click",function(){m(e);let t=d();return p(t.viewReports())}),n(25,"div",11)(26,"div",20),g(27,"i",21),o(),n(28,"h4",14),l(29,"History"),o(),n(30,"p",15),l(31,"View past submissions and reports."),o(),n(32,"button",22),l(33,"View Records"),o()()()()()}}function It(r,h){if(r&1&&(n(0,"option",42),l(1),o()),r&2){let e=h.$implicit,i=h.index;c("value",i+1),s(),E(e)}}function Mt(r,h){if(r&1&&(n(0,"div",43),l(1),o()),r&2){let e=d(2);s(),C(" ",e.errorMessage," ")}}function Vt(r,h){r&1&&g(0,"span",44)}function Pt(r,h){if(r&1){let e=y();n(0,"div",23)(1,"div",24)(2,"div",25)(3,"h3",26),l(4),o(),n(5,"button",27),u("click",function(){m(e);let t=d();return p(t.toggleEntryForm())}),o()(),n(6,"div",28),g(7,"i",29),l(8),o(),n(9,"div",30)(10,"div",31)(11,"label",32),l(12,"Select Month"),o(),n(13,"select",33),S("ngModelChange",function(t){m(e);let a=d();return v(a.selectedMonth,t)||(a.selectedMonth=t),p(t)}),u("ngModelChange",function(){m(e);let t=d();return p(t.onSelectionChange())}),b(14,It,2,2,"option",34),o()(),n(15,"div",31)(16,"label",32),l(17,"Select Year"),o(),n(18,"input",35),S("ngModelChange",function(t){m(e);let a=d();return v(a.selectedYear,t)||(a.selectedYear=t),p(t)}),u("ngModelChange",function(){m(e);let t=d();return p(t.onSelectionChange())}),o()(),n(19,"div",36)(20,"label",32),l(21,"Last Working Day (Date)"),o(),n(22,"input",37),S("ngModelChange",function(t){m(e);let a=d();return v(a.lastWorkingDay,t)||(a.lastWorkingDay=t),p(t)}),o()()(),b(23,Mt,2,1,"div",38),n(24,"div",39)(25,"button",40),u("click",function(){m(e);let t=d();return p(t.startEntry())}),b(26,Vt,1,0,"span",41),l(27),o()()()()}if(r&2){let e=d();s(4),C(" ",e.targetMode==="casual"?"Casual Attendance Entry":"New Monthly Payroll"," "),s(2),c("ngClass",e.targetMode==="casual"?"alert-warning bg-warning-subtle text-warning-emphasis":"alert-info bg-info-subtle text-info-emphasis"),s(2),C(" Select Period to ",e.targetMode==="casual"?"Mark Attendance":"File Report",". "),s(5),x("ngModel",e.selectedMonth),s(),c("ngForOf",e.months),s(4),x("ngModel",e.selectedYear),s(4),x("ngModel",e.lastWorkingDay),s(),c("ngIf",e.errorMessage),s(2),c("ngClass",e.targetMode==="casual"?"btn-warning text-dark":"btn-primary")("disabled",e.isLoading),s(),c("ngIf",e.isLoading),s(),C(" ",e.isLoading?"Processing...":e.targetMode==="casual"?"Open Attendance":"Create / Open Entry"," ")}}var Qe=(()=>{class r{constructor(e,i,t,a){this.http=e,this.router=i,this.payrollService=t,this.monthService=a,this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.selectedMonth=new Date().getMonth()+1,this.selectedYear=new Date().getFullYear(),this.lastWorkingDay=new Date().toISOString().split("T")[0],this.showEntryForm=!1,this.targetMode="payroll",this.isLoading=!1,this.errorMessage=null,this.existingPeriods=[]}ngOnInit(){this.fetchPeriods()}fetchPeriods(){this.payrollService.getPeriods().subscribe({next:e=>{this.existingPeriods=e,this.checkAndPopulateDate()},error:e=>console.error("Failed to fetch existing periods",e)})}checkAndPopulateDate(){let e=this.existingPeriods.find(i=>i.month==this.selectedMonth&&i.year==this.selectedYear);e&&e.lastWorkingDay&&(this.lastWorkingDay=e.lastWorkingDay)}onSelectionChange(){this.checkAndPopulateDate()}ngOnDestroy(){this.monthSelectionSub&&this.monthSelectionSub.unsubscribe()}toggleEntryForm(e="payroll"){this.targetMode=e,this.showEntryForm=!this.showEntryForm,this.errorMessage=null}viewReports(){this.router.navigate(["/reports"])}startEntry(){this.isLoading=!0,this.errorMessage=null;let e={month:this.selectedMonth,year:this.selectedYear,lastWorkingDay:this.lastWorkingDay};this.http.post("http://localhost:8080/api/payroll/periods",e).subscribe({next:i=>{this.targetMode==="casual"?this.router.navigate(["/payroll/attendance-casual",i.id]):this.router.navigate(["/payroll/entry",i.id])},error:i=>{console.error(i),this.isLoading=!1,i.status===409?(this.errorMessage="Period exists. Finding it...",this.payrollService.getPeriods().subscribe(t=>{let a=t.find(f=>f.month==this.selectedMonth&&f.year==this.selectedYear);a?this.targetMode==="casual"?this.router.navigate(["/payroll/attendance-casual",a.id]):this.router.navigate(["/payroll/entry",a.id]):this.errorMessage="Period exists but could not be found. Please check History."})):this.errorMessage=i.error?.message||i.message||"Failed to start period."}})}static{this.\u0275fac=function(i){return new(i||r)(_(L),_(V),_(j),_(oe))}}static{this.\u0275cmp=w({type:r,selectors:[["app-user-dashboard"]],standalone:!0,features:[k],decls:10,vars:2,consts:[[1,"container","mt-5","fade-in"],[1,"row","justify-content-center"],[1,"col-lg-8"],[1,"text-center","mb-4"],[1,"display-4","fw-bold","text-dark"],[1,"text-muted","lead"],["class","row g-4 justify-content-center",4,"ngIf"],["class","card shadow-lg border-0 rounded-4 fade-in",4,"ngIf"],[1,"row","g-4","justify-content-center"],[1,"col-md-4"],[1,"card","h-100","shadow-sm","border-0","rounded-4","action-card",3,"click"],[1,"card-body","p-4","text-center"],[1,"icon-circle","mb-3","bg-success-subtle","text-success"],[1,"bi","bi-file-earmark-plus"],[1,"fw-bold"],[1,"text-muted","small"],[1,"btn","btn-outline-success","rounded-pill","px-4","mt-2","w-100"],[1,"icon-circle","mb-3","bg-warning-subtle","text-warning"],[1,"bi","bi-calendar-check"],[1,"btn","btn-outline-warning","rounded-pill","px-4","mt-2","w-100","text-dark"],[1,"icon-circle","mb-3","bg-primary-subtle","text-primary"],[1,"bi","bi-clock-history"],[1,"btn","btn-outline-primary","rounded-pill","px-4","mt-2","w-100"],[1,"card","shadow-lg","border-0","rounded-4","fade-in"],[1,"card-body","p-5"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"fw-bold","mb-0"],[1,"btn","btn-close",3,"click"],[1,"alert","border-0","mb-4",3,"ngClass"],[1,"bi","bi-info-circle-fill","me-2"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label","fw-bold"],[1,"form-select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","number",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"d-grid","gap-2","mt-4"],[1,"btn","btn-lg","rounded-pill","fw-bold",3,"click","ngClass","disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[3,"value"],[1,"alert","alert-danger","mt-3"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),l(5,"Payroll Dashboard"),o(),n(6,"p",5),l(7,"Manage monthly payroll submissions effortlessly"),o()(),b(8,kt,34,0,"div",6)(9,Pt,28,12,"div",7),o()()()),i&2&&(s(8),c("ngIf",!t.showEntryForm),s(),c("ngIf",t.showEntryForm))},dependencies:[M,O,U,I,P,J,K,A,ie,G,F,N],styles:[`.icon-circle[_ngcontent-%COMP%] {
          width: 80px; height: 80px;
          border-radius: 50%;
          display: inline-flex;
          align-items: center; justify-content: center;
          font-size: 2.5rem;
      }
      .action-card[_ngcontent-%COMP%] {
          transition: transform 0.2s, box-shadow 0.2s;
          cursor: pointer;
      }
      .action-card[_ngcontent-%COMP%]:hover {
          transform: translateY(-5px);
          box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
      }
      .fade-in[_ngcontent-%COMP%] {
          animation: _ngcontent-%COMP%_fadeIn 0.3s ease-in;
      }
      @keyframes _ngcontent-%COMP%_fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }`]})}}return r})();var X=(r,h)=>{let e=de(B),i=de(V),t=e.getRole();if(t){let a=r.data.roles;return a&&a.length>0?a.includes(t)?!0:t==="ADMIN"?i.parseUrl("/admin/employees"):i.parseUrl("/user/home"):!0}return i.parseUrl("/login")};var Xe=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:He},{path:"admin/employees",component:Ge,canActivate:[X],data:{roles:["ADMIN"]}},{path:"user/home",component:Qe,canActivate:[X],data:{roles:["USER"]}},{path:"payroll/entry/:periodId",component:Je,canActivate:[X],data:{roles:["USER"]}},{path:"reports",component:Ke,canActivate:[X],data:{roles:["USER","ADMIN"]}},{path:"payroll/attendance-casual/:periodId",loadComponent:()=>import("./chunk-P734574K.js").then(r=>r.CasualAttendanceComponent),canActivate:[X],data:{roles:["USER"]}},{path:"**",redirectTo:"login"}];Me(Be,{providers:[Te(Xe,Le()),ke(Ie()),{provide:me,useClass:Ye,multi:!0},{provide:me,useClass:ze,multi:!0}]}).catch(r=>console.error(r));
