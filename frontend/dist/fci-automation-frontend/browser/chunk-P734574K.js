import{$ as T,A as S,C as l,D as _,E as D,F as w,G as I,K as A,R as E,S as L,V as O,W as P,i as C,j as h,k as b,l as a,m as y,n as m,o as k,p as s,r as v,s as o,sa as F,t as r,ta as V,u as f,ua as W,x,y as g,z as c}from"./chunk-B5YIJ3GE.js";function z(n,d){n&1&&(o(0,"span",21),l(1,"LOCKED"),r())}function M(n,d){if(n&1&&(o(0,"p",22),l(1),r()),n&2){let e=c();a(),I(" Period: ",e.period.month,"/",e.period.year," | Last Working Day: ",e.period.lastWorkingDay," ")}}function j(n,d){if(n&1){let e=x();o(0,"button",23),g("click",function(){h(e);let i=c();return b(i.unlock())}),f(1,"i",24),l(2," Unlock "),r()}if(n&2){let e=c();s("disabled",e.isLoading)}}function G(n,d){if(n&1){let e=x();o(0,"button",25),g("click",function(){h(e);let i=c();return b(i.lock())}),f(1,"i",26),l(2," Lock & Finalize "),r()}if(n&2){let e=c();s("disabled",e.isLoading||e.hasValidationErrors())}}function N(n,d){n&1&&f(0,"span",27)}function U(n,d){n&1&&f(0,"i",28)}function H(n,d){if(n&1){let e=x();o(0,"th",29),g("click",function(){let i=h(e).$implicit,p=c();return b(p.toggleDayGlobally(i))}),l(1),r()}if(n&2){let e=d.$implicit,t=c();v("bg-primary",t.isDayGloballyActive(e))("text-white",t.isDayGloballyActive(e)),S("title","Click to toggle attendance for all employees on Day ",e,""),a(),D(" ",e," ")}}function K(n,d){if(n&1){let e=x();o(0,"td",37)(1,"div",38)(2,"input",39),g("change",function(){let i=h(e).$implicit,p=c().$implicit,u=c();return b(u.toggleDay(p,i))}),r()()()}if(n&2){let e=d.$implicit,t=c().$implicit,i=c();a(2),s("checked",i.isDayActive(t,e))("disabled",(i.period==null?null:i.period.status)==="CLOSED")}}function R(n,d){n&1&&(o(0,"small",40),l(1," Mismatch "),r())}function q(n,d){if(n&1&&(o(0,"tr")(1,"td",30)(2,"div",31),l(3),r(),o(4,"div",32),l(5),r()(),m(6,K,3,2,"td",33),o(7,"td",34)(8,"div",35)(9,"span"),l(10),r(),m(11,R,2,0,"small",36),r()()()),n&2){let e=d.$implicit,t=c();v("table-secondary",(t.period==null?null:t.period.status)==="CLOSED"),a(3),_(e.employee.fullName),a(2),_(e.employee.memberId),a(),s("ngForOf",t.days),a(),v("bg-success-subtle",e.activeDays.length===e.daysWorked)("bg-danger-subtle",e.activeDays.length!==e.daysWorked),a(2),v("text-danger",e.activeDays.length!==e.daysWorked)("text-success",e.activeDays.length===e.daysWorked),a(),w(" ",e.activeDays.length," / ",e.daysWorked," "),a(),s("ngIf",e.activeDays.length!==e.daysWorked)}}function B(n,d){if(n&1&&(o(0,"tr")(1,"td",41)(2,"div",42),l(3,"Loading or No Casual Labourers Found..."),r()()()),n&2){let e=c();a(),k("colspan",e.days.length+2)}}var ne=(()=>{class n{constructor(e,t,i,p){this.http=e,this.route=t,this.payrollService=i,this.dialogService=p,this.entries=[],this.period=null,this.periodId="",this.isLoading=!1,this.days=Array.from({length:31},(u,$)=>$+1)}ngOnInit(){this.route.params.subscribe(e=>{this.periodId=e.periodId,this.loadData()})}loadData(){this.payrollService.loadPeriod(this.periodId),this.payrollService.currentPeriod$.subscribe(e=>this.period=e),this.http.get(`http://localhost:8080/api/payroll/periods/${this.periodId}/entries`).subscribe({next:e=>{this.entries=e.filter(t=>t.employee.category==="CL"),this.entries.forEach(t=>{t.activeDays||(t.activeDays=[])})},error:e=>console.error(e)})}isDayActive(e,t){return e.activeDays?.includes(t)}toggleDay(e,t){e.activeDays||(e.activeDays=[]);let i=e.activeDays.indexOf(t);i>-1?e.activeDays.splice(i,1):e.activeDays.push(t)}isDayGloballyActive(e){return!this.entries||this.entries.length===0?!1:this.entries.every(t=>this.isDayActive(t,e))}toggleDayGlobally(e){if(this.period?.status==="CLOSED")return;let i=!this.isDayGloballyActive(e);this.entries.forEach(p=>{p.activeDays||(p.activeDays=[]);let u=p.activeDays.indexOf(e);i?u===-1&&p.activeDays.push(e):u>-1&&p.activeDays.splice(u,1)})}hasValidationErrors(){return this.entries.some(e=>(e.activeDays?.length||0)!==(e.daysWorked||0))}unlock(){this.dialogService.confirm("Unlock Period","Are you sure you want to Unlock this period? This will allow edits to both Payroll and Attendance.").subscribe(e=>{e&&(this.isLoading=!0,this.payrollService.reopenPeriod(this.periodId).subscribe({next:t=>{this.period=t,this.isLoading=!1,this.dialogService.alert("Success","Period Unlocked Successfully!"),this.loadData()},error:t=>{this.isLoading=!1,this.dialogService.alert("Error","Failed to unlock: "+t.message)}}))})}lock(){this.dialogService.confirm("Lock Period","Are you sure you want to Lock this period? No further edits will be allowed until unlocked.").subscribe(e=>{e&&(this.isLoading=!0,this.payrollService.finalizePeriod(this.periodId).subscribe({next:t=>{this.period=t,this.isLoading=!1,this.dialogService.alert("Success","Period Locked Successfully!"),this.loadData()},error:t=>{this.isLoading=!1,this.dialogService.alert("Error","Failed to lock: "+t.message)}}))})}save(){this.isLoading=!0,this.http.put("http://localhost:8080/api/payroll/entries",this.entries).subscribe({next:e=>{this.isLoading=!1,this.dialogService.alert("Success","Attendance Saved Successfully!")},error:e=>{this.isLoading=!1,this.dialogService.alert("Error","Failed to save: "+e.message)}})}static{this.\u0275fac=function(t){return new(t||n)(y(P),y(T),y(W),y(V))}}static{this.\u0275cmp=C({type:n,selectors:[["app-casual-attendance"]],standalone:!0,features:[A],decls:28,vars:10,consts:[[1,"container-fluid","py-4","min-vh-100","bg-light"],[1,"d-flex","justify-content-between","align-items-center","mb-4","px-3"],[1,"fw-bold","mb-0","text-dark"],[1,"bi","bi-calendar-check","me-2","text-primary"],["class","badge bg-danger ms-2",4,"ngIf"],["class","text-muted mb-0 small",4,"ngIf"],[1,"d-flex","gap-2"],["class","btn btn-warning d-flex align-items-center me-2",3,"disabled","click",4,"ngIf"],["class","btn btn-danger d-flex align-items-center me-2",3,"disabled","click",4,"ngIf"],[1,"btn","btn-primary","d-flex","align-items-center",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","bi bi-save me-2",4,"ngIf"],[1,"card","border-0","shadow-sm","mx-3","overflow-hidden","rounded-3"],[1,"table-responsive"],[1,"table","table-bordered","table-hover","mb-0","align-middle","text-center"],[1,"bg-dark","text-white"],[1,"py-3","px-4","text-start",2,"position","sticky","left","0","z-index","10","background","#212529","min-width","200px"],["class","p-1","style","min-width: 35px; font-size: 0.8rem; cursor: pointer;",3,"title","bg-primary","text-white","click",4,"ngFor","ngForOf"],[1,"py-3","bg-secondary","text-white",2,"min-width","60px"],[3,"table-secondary",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"badge","bg-danger","ms-2"],[1,"text-muted","mb-0","small"],[1,"btn","btn-warning","d-flex","align-items-center","me-2",3,"click","disabled"],[1,"bi","bi-unlock-fill","me-2"],[1,"btn","btn-danger","d-flex","align-items-center","me-2",3,"click","disabled"],[1,"bi","bi-lock-fill","me-2"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-save","me-2"],[1,"p-1",2,"min-width","35px","font-size","0.8rem","cursor","pointer",3,"click","title"],[1,"text-start","px-3","bg-white",2,"position","sticky","left","0","z-index","5"],[1,"fw-bold","text-dark"],[1,"small","text-muted","font-monospace"],["class","p-0",4,"ngFor","ngForOf"],[1,"fw-bold"],[1,"d-flex","flex-column","align-items-center"],["class","text-danger","style","font-size: 0.7rem;",4,"ngIf"],[1,"p-0"],[1,"form-check","d-flex","justify-content-center","align-items-center","h-100","m-0",2,"min-height","40px"],["type","checkbox",1,"form-check-input","border-secondary",3,"change","checked","disabled"],[1,"text-danger",2,"font-size","0.7rem"],[1,"text-center","py-5"],[1,"text-muted"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2),f(4,"i",3),l(5,"Casual Labour Attendance "),m(6,z,2,0,"span",4),r(),m(7,M,2,3,"p",5),r(),o(8,"div",6),m(9,j,3,1,"button",7)(10,G,3,1,"button",8),o(11,"button",9),g("click",function(){return i.save()}),m(12,N,1,0,"span",10)(13,U,1,0,"i",11),l(14," Save Attendance "),r()()(),o(15,"div",12)(16,"div",13)(17,"table",14)(18,"thead",15)(19,"tr")(20,"th",16),l(21,"Employee"),r(),m(22,H,2,7,"th",17),o(23,"th",18),l(24,"Total"),r()()(),o(25,"tbody"),m(26,q,12,16,"tr",19)(27,B,4,1,"tr",20),r()()()()()),t&2&&(a(6),s("ngIf",(i.period==null?null:i.period.status)==="CLOSED"),a(),s("ngIf",i.period),a(2),s("ngIf",(i.period==null?null:i.period.status)==="CLOSED"),a(),s("ngIf",(i.period==null?null:i.period.status)==="OPEN"),a(),s("disabled",(i.period==null?null:i.period.status)==="CLOSED"||i.isLoading||i.hasValidationErrors()),a(),s("ngIf",i.isLoading),a(),s("ngIf",!i.isLoading),a(9),s("ngForOf",i.days),a(4),s("ngForOf",i.entries),a(),s("ngIf",i.entries.length===0))},dependencies:[O,E,L,F],styles:[".table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar{height:8px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#ccc;border-radius:4px}.table-responsive[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}"]})}}return n})();export{ne as CasualAttendanceComponent};
